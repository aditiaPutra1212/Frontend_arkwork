(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4178],{70430:function(e,t,n){Promise.resolve().then(n.bind(n,1380))},99376:function(e,t,n){"use strict";var a=n(35475);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},40257:function(e,t,n){"use strict";var a,r;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,a,r=e.exports={};function l(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var o=[],u=!1,c=-1;function d(){u&&a&&(u=!1,a.length?o=a.concat(o):c=-1,o.length&&m())}function m(){if(!u){var e=i(d);u=!0;for(var t=o.length;t;){for(a=o,o=[];++c<t;)a&&a[c].run();c=-1,t=o.length}a=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new h(e,t)),1!==o.length||u||i(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var l=n[e]={exports:{}},s=!0;try{t[e](l,l.exports,a),s=!1}finally{s&&delete n[e]}return l.exports}a.ab="//";var r=a(229);e.exports=r}()},1380:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var a=n(57437),r=n(2265),l=n(84603),s=n(38706),i=n(99376);let o="ark_users",u="ark_nav_avatar:",c="ark_nav_name:";function d(){return new Promise((e,t)=>{let n=indexedDB.open("ark_db",2);n.onupgradeneeded=()=>{let e=n.result;e.objectStoreNames.contains("avatar_files")||e.createObjectStore("avatar_files")},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}async function m(e,t){let n=await d();await new Promise((a,r)=>{let l=n.transaction("avatar_files","readwrite");l.objectStore("avatar_files").put(t,e),l.oncomplete=()=>a(),l.onerror=()=>r(l.error)}),n.close()}async function h(e){let t=await d(),n=await new Promise((n,a)=>{let r=t.transaction("avatar_files","readonly").objectStore("avatar_files").get(e);r.onsuccess=()=>{var e;return n(null!==(e=r.result)&&void 0!==e?e:null)},r.onerror=()=>a(r.error)});return t.close(),n}async function p(e){let t=await d();await new Promise((n,a)=>{let r=t.transaction("avatar_files","readwrite");r.objectStore("avatar_files").delete(e),r.oncomplete=()=>n(),r.onerror=()=>a(r.error)}),t.close()}let f=()=>{try{var e;return JSON.parse(null!==(e=localStorage.getItem(o))&&void 0!==e?e:"[]")}catch(e){return[]}},x=e=>localStorage.setItem(o,JSON.stringify(e));function v(e){let{children:t}=e;return(0,a.jsx)("label",{className:"mb-1.5 block text-sm font-medium text-neutral-800",children:t})}function g(e){let{className:t,...n}=e;return(0,a.jsx)("input",{...n,className:"w-full rounded-xl border border-neutral-300 bg-white px-3.5 py-2.5 text-sm text-neutral-900 placeholder-neutral-400 outline-none transition focus:border-neutral-900 ".concat(null!=t?t:"")})}function b(e){let{toast:t,onClose:n}=e;if(!t)return null;let r="success"===t.type?"bg-green-50 text-green-800 border-green-200":"error"===t.type?"bg-red-50 text-red-700 border-red-200":"bg-neutral-50 text-neutral-700 border-neutral-200";return(0,a.jsx)("div",{className:"rounded-2xl border px-4 py-3 text-sm ".concat(r),children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsx)("span",{children:t.message}),(0,a.jsx)("button",{onClick:n,className:"text-xs opacity-70 hover:opacity-100",children:"✕"})]})})}async function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:160,n=await new Promise((t,n)=>{let a=URL.createObjectURL(e),r=new Image;r.onload=()=>{URL.revokeObjectURL(a),t(r)},r.onerror=e=>n(e),r.src=a}),a=document.createElement("canvas"),r=t/Math.max(n.width,n.height);return a.width=Math.round(n.width*r),a.height=Math.round(n.height*r),a.getContext("2d").drawImage(n,0,0,a.width,a.height),a.toDataURL("image/jpeg",.85)}function w(e){let{value:t,onChange:n,labelProv:l="Provinsi",labelKab:s="Kabupaten/Kota",labelKec:i="Kecamatan"}=e,[o,u]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),[m,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(null),[x,v]=(0,r.useState)(null),[g,b]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("https://www.emsifa.com/api-wilayah-indonesia/api/provinces.json"),t=(await e.json()||[]).map(e=>({id:String(e.id),name:e.name}));u(t)}catch(e){u([])}})()},[]),(0,r.useEffect)(()=>{if(!p){d([]),v(null),h([]),b(null);return}(async()=>{try{let e=await fetch("https://www.emsifa.com/api-wilayah-indonesia/api/regencies/".concat(p.id,".json")),t=(await e.json()||[]).map(e=>({id:String(e.id),name:e.name}));d(t),v(null),h([]),b(null)}catch(e){d([]),v(null)}})()},[null==p?void 0:p.id]),(0,r.useEffect)(()=>{if(!x){h([]),b(null);return}(async()=>{try{let e=await fetch("https://www.emsifa.com/api-wilayah-indonesia/api/districts/".concat(x.id,".json")),t=(await e.json()||[]).map(e=>({id:String(e.id),name:e.name}));h(t),b(null)}catch(e){h([]),b(null)}})()},[null==x?void 0:x.id]),(0,r.useEffect)(()=>{n([null==g?void 0:g.name,null==x?void 0:x.name,null==p?void 0:p.name].filter(Boolean).join(", "))},[p,x,g]);let j=e=>{let{value:t,setValue:n,options:r,placeholder:l,disabled:s}=e;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:(null==t?void 0:t.id)||"",onChange:e=>{let t=e.target.value;n(r.find(e=>e.id===t)||null)},disabled:s,className:"w-full appearance-none rounded-xl border border-neutral-300 bg-white px-3.5 py-2.5 pr-10 text-sm outline-none focus:border-neutral-900 disabled:bg-neutral-100 disabled:text-neutral-500",children:[(0,a.jsx)("option",{value:"",children:l}),r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-neutral-500",children:"▾"})]})};return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid gap-3 sm:grid-cols-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"mb-1 block text-sm text-neutral-700",children:l}),(0,a.jsx)(j,{value:p,setValue:f,options:o,placeholder:"Pilih provinsi…"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"mb-1 block text-sm text-neutral-700",children:s}),(0,a.jsx)(j,{value:x,setValue:v,options:c,placeholder:"Pilih kab/kota…",disabled:!p})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"mb-1 block text-sm text-neutral-700",children:i}),(0,a.jsx)(j,{value:g,setValue:b,options:m,placeholder:"Pilih kecamatan…",disabled:!x})]})]}),t&&(0,a.jsxs)("div",{className:"text-xs text-neutral-600",children:["Dipilih: ",(0,a.jsx)("span",{className:"font-medium",children:t})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"button",onClick:()=>{f(null),v(null),b(null),n("Remote")},className:"rounded-lg border border-neutral-300 px-3 py-1.5 text-xs text-neutral-700 hover:bg-neutral-50",children:"Pilih “Remote”"})})]})}function y(){var e;let t=(0,s.T_)("profile"),{user:n}=(0,l.a)(),o=(0,i.useRouter)(),d=null!==(e=null==n?void 0:n.email)&&void 0!==e?e:null,y=!d,[N,k]=(0,r.useState)(""),[S,T]=(0,r.useState)(""),[E,_]=(0,r.useState)(""),[L,P]=(0,r.useState)(null),[R,U]=(0,r.useState)(null),[O,C]=(0,r.useState)(!1),[I,G]=(0,r.useState)(!1),[M,A]=(0,r.useState)(null);async function D(e){if(d){if(!e.type.startsWith("image/")){A({type:"error",message:"File harus gambar (PNG/JPG/SVG)."});return}if(e.size/1048576>2){A({type:"error",message:"Ukuran foto maksimum ".concat(2,"MB")});return}G(!0);try{let t="avatar:".concat(d);await m(t,e),P({name:e.name,type:e.type,key:t});let n=URL.createObjectURL(e);U(e=>(e&&URL.revokeObjectURL(e),n));let a=await j(e,160);localStorage.setItem(u+d,a),window.dispatchEvent(new Event("ark:avatar-updated")),A({type:"success",message:"Foto profil diperbarui."})}catch(e){A({type:"error",message:"Gagal mengunggah foto."})}finally{G(!1)}}}async function F(){if(d)try{(null==L?void 0:L.key)&&await p(L.key),U(e=>(e&&URL.revokeObjectURL(e),null)),P(null),localStorage.removeItem(u+d);let e=f(),t=e.findIndex(e=>e.email===d);t>=0&&(e[t].profile={...e[t].profile,photo:null},e[t].updatedAt=new Date().toISOString(),x(e)),window.dispatchEvent(new Event("ark:avatar-updated")),A({type:"success",message:"Foto profil dihapus."})}catch(e){A({type:"error",message:"Gagal menghapus foto."})}}return((0,r.useEffect)(()=>{if(y){let e=setTimeout(()=>o.replace("/auth/signin"),50);return()=>clearTimeout(e)}},[y,o]),(0,r.useEffect)(()=>{if(!M)return;let e=setTimeout(()=>A(null),2200);return()=>clearTimeout(e)},[M]),(0,r.useEffect)(()=>{var e,t,n,a,r,l,s;if(!d)return;let i=f().find(e=>e.email===d);k((null!==(s=localStorage.getItem(c+d))&&void 0!==s?s:"")||(null==i?void 0:i.name)||""),T(null!==(a=null==i?void 0:null===(e=i.profile)||void 0===e?void 0:e.location)&&void 0!==a?a:""),_(null!==(r=null==i?void 0:null===(t=i.profile)||void 0===t?void 0:t.phone)&&void 0!==r?r:""),P(null!==(l=null==i?void 0:null===(n=i.profile)||void 0===n?void 0:n.photo)&&void 0!==l?l:null)},[d]),(0,r.useEffect)(()=>{let e=null,t=!1;return(async()=>{if(!L){U(null);return}let n=await h(L.key);if(!n){U(null);return}e=URL.createObjectURL(n),t||U(e)})(),()=>{t=!0,e&&URL.revokeObjectURL(e)}},[null==L?void 0:L.key]),y)?(0,a.jsx)("div",{className:"grid min-h-[60vh] place-items-center px-4",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-sm text-neutral-600",children:"Mengarahkan ke halaman masuk…"})})}):(0,a.jsx)("div",{className:"min-h-screen bg-neutral-50 py-10",children:(0,a.jsxs)("div",{className:"mx-auto max-w-4xl space-y-6 px-4 sm:px-6",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-neutral-900",children:t("title")||"Profil Saya"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("button",{onClick:function(){if(d){C(!0);try{let e=f(),n=new Date().toISOString(),a=e.findIndex(e=>e.email===d),r={email:d,name:N,profile:{location:S,phone:E,photo:L,photoUrl:null!=R?R:null},createdAt:a>=0?e[a].createdAt:n,updatedAt:n};a>=0?e[a]={...e[a],...r}:e.push(r),x(e),localStorage.setItem(c+d,N),window.dispatchEvent(new Event("ark:name-updated")),A({type:"success",message:t("toast.saved")||"Tersimpan."})}catch(e){A({type:"error",message:t("toast.failed")||"Gagal menyimpan."})}finally{C(!1)}}},disabled:O,className:"rounded-xl bg-neutral-900 px-5 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-neutral-800 disabled:cursor-not-allowed disabled:opacity-60",children:O?t("actions.saving")||"Menyimpan...":t("actions.save")||"Simpan Profil"})})]}),(0,a.jsx)(b,{toast:M,onClose:()=>A(null)}),(0,a.jsxs)("div",{className:"rounded-2xl border border-neutral-200 bg-white p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center gap-5",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"h-20 w-20 overflow-hidden rounded-full border border-neutral-300 bg-neutral-100",children:R?(0,a.jsx)("img",{src:R,alt:"avatar",className:"h-full w-full object-cover"}):(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center text-sm text-neutral-500",children:((null==N?void 0:N[0])||(null==d?void 0:d[0])||"U").toUpperCase()})})}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("label",{className:"inline-flex cursor-pointer items-center gap-2",children:[(0,a.jsx)("span",{className:"rounded-lg bg-neutral-900 px-3 py-1.5 text-xs font-medium text-white hover:bg-neutral-800",children:"Ubah Foto"}),(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&(await D(n),e.currentTarget.value="")}})]}),L&&(0,a.jsx)("button",{onClick:F,className:"rounded-lg border border-neutral-300 px-3 py-1.5 text-xs text-neutral-700 transition hover:bg-neutral-50",children:"Hapus Foto"}),I&&(0,a.jsx)("span",{className:"text-xs text-neutral-500",children:"Mengunggah..."})]})]}),(0,a.jsxs)("div",{className:"grid gap-5 md:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(v,{children:"Nama Lengkap"}),(0,a.jsx)(g,{value:N,onChange:e=>k(e.target.value),placeholder:"Nama lengkap"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v,{children:"Email"}),(0,a.jsx)(g,{readOnly:!0,value:null!=d?d:"",className:"bg-neutral-100"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)(v,{children:"Lokasi"}),(0,a.jsx)(w,{value:S,onChange:T})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v,{children:"Nomor HP"}),(0,a.jsx)(g,{value:E,onChange:e=>_(e.target.value),placeholder:"08xxxx"})]})]})]})]})})}},38706:function(e,t,n){"use strict";n.d(t,{T_:function(){return l}});var a=n(64574);function r(e,t){return(...e)=>{try{return t(...e)}catch{throw Error(void 0)}}}let l=r(0,a.T_);r(0,a.Gb)}},function(e){e.O(0,[4574,4603,2971,2117,1744],function(){return e(e.s=70430)}),_N_E=e.O()}]);