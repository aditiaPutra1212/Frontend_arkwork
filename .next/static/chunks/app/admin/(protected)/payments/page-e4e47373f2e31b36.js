(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3081],{35285:function(e,t,a){Promise.resolve().then(a.bind(a,11186))},40257:function(e,t,a){"use strict";var n,s;e.exports=(null==(n=a.g.process)?void 0:n.env)&&"object"==typeof(null==(s=a.g.process)?void 0:s.env)?a.g.process:a(44227)},44227:function(e){!function(){var t={229:function(e){var t,a,n,s=e.exports={};function r(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{a="function"==typeof clearTimeout?clearTimeout:l}catch(e){a=l}}();var o=[],c=!1,d=-1;function u(){c&&n&&(c=!1,n.length?o=n.concat(o):d=-1,o.length&&m())}function m(){if(!c){var e=i(u);c=!0;for(var t=o.length;t;){for(n=o,o=[];++d<t;)n&&n[d].run();d=-1,t=o.length}n=null,c=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===l||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function x(e,t){this.fun=e,this.array=t}function h(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];o.push(new x(e,t)),1!==o.length||c||i(m)},x.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=h,s.addListener=h,s.once=h,s.off=h,s.removeListener=h,s.removeAllListeners=h,s.emit=h,s.prependListener=h,s.prependOnceListener=h,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},a={};function n(e){var s=a[e];if(void 0!==s)return s.exports;var r=a[e]={exports:{}},l=!0;try{t[e](r,r.exports,n),l=!1}finally{l&&delete a[e]}return r.exports}n.ab="//";var s=n(229);e.exports=s}()},11186:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var n,s=a(57437),r=a(2265),l=a(71837),i=a(40257);let o=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(e);function c(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}function d(e){let{children:t,className:a=""}=e;return(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold ".concat(a),children:t})}function u(e){let{children:t,className:a=""}=e;return(0,s.jsx)("td",{className:"px-4 py-3 align-top ".concat(a),children:t})}function m(e){let{label:t,children:a}=e;return(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)("div",{className:"col-span-1 text-slate-500",children:t}),(0,s.jsx)("div",{className:"col-span-2 font-medium text-slate-800 break-all",children:a})]})}let x=null!==(n=i.env.NEXT_PUBLIC_MIDTRANS_CLIENT_KEY)&&void 0!==n?n:"",h={settlement:"bg-emerald-100 text-emerald-700",capture:"bg-emerald-100 text-emerald-700",pending:"bg-amber-100 text-amber-700",deny:"bg-rose-100 text-rose-700",cancel:"bg-rose-100 text-rose-700",expire:"bg-slate-200 text-slate-700",refund:"bg-violet-100 text-violet-700",failure:"bg-rose-100 text-rose-700"};function p(){let[e,t]=(0,r.useState)("inbox");return(0,r.useEffect)(()=>{if(window.snap||!x)return;let e="midtrans-snap-script";if(document.getElementById(e))return;let t=document.createElement("script");t.id=e,t.src="https://app.sandbox.midtrans.com/snap/snap.js",t.setAttribute("data-client-key",x),t.async=!0,document.body.appendChild(t)},[]),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-slate-900",children:"Payments (Midtrans)"}),(0,s.jsx)("p",{className:"text-sm text-slate-600",children:"Kelola pembayaran perusahaan (inbox), dan opsional uji coba Snap pada tab Manual Checkout."})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-slate-200 p-1",children:[(0,s.jsx)("button",{onClick:()=>t("inbox"),className:c("rounded-lg px-3 py-1.5 text-sm","inbox"===e?"bg-slate-900 text-white":"text-slate-700"),children:"Inbox"}),(0,s.jsx)("button",{onClick:()=>t("checkout"),className:c("rounded-lg px-3 py-1.5 text-sm","checkout"===e?"bg-slate-900 text-white":"text-slate-700"),children:"Manual Checkout (Test)"})]})]}),"inbox"===e?(0,s.jsx)(b,{}):(0,s.jsx)(f,{})]})}function b(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(null),[i,c]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[p,b]=(0,r.useState)("");async function f(){let{cursor:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(!0),x(null);try{let a=new URLSearchParams;e&&a.set("cursor",e),p&&a.set("status",p);let s=await (0,l.hi)("/api/payments?".concat(a.toString()));e?t(e=>[...e,...s.items]):t(s.items),n(s.nextCursor)}catch(e){x((null==e?void 0:e.message)||"Gagal memuat pembayaran")}finally{c(!1)}}return(0,r.useEffect)(()=>{f()},[p]),(0,r.useEffect)(()=>{let e=()=>f(),t=e=>{"ark:payment:ping"===e.key&&f()},a=null;try{(a=new BroadcastChannel("ark_payments")).onmessage=()=>f()}catch(e){}return window.addEventListener("ark:payment",e),window.addEventListener("storage",t),()=>{window.removeEventListener("ark:payment",e),window.removeEventListener("storage",t);try{null==a||a.close()}catch(e){}}},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-2",children:[(0,s.jsxs)("select",{value:p,onChange:e=>b(e.target.value),className:"rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm",title:"Filter status",children:[(0,s.jsx)("option",{value:"",children:"Semua status"}),(0,s.jsx)("option",{value:"settlement",children:"Settlement"}),(0,s.jsx)("option",{value:"pending",children:"Pending"}),(0,s.jsx)("option",{value:"capture",children:"Capture"}),(0,s.jsx)("option",{value:"expire",children:"Expire"}),(0,s.jsx)("option",{value:"cancel",children:"Cancel"}),(0,s.jsx)("option",{value:"deny",children:"Deny"}),(0,s.jsx)("option",{value:"refund",children:"Refund"}),(0,s.jsx)("option",{value:"failure",children:"Failure"})]}),(0,s.jsx)("button",{onClick:()=>f(),className:"rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm hover:bg-slate-50",children:"Refresh"})]}),m&&(0,s.jsx)("div",{className:"mb-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-2 text-rose-700",children:m}),(0,s.jsx)("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-slate-50 text-slate-600",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)(d,{children:"Waktu"}),(0,s.jsx)(d,{children:"Perusahaan"}),(0,s.jsx)(d,{children:"Paket"}),(0,s.jsx)(d,{className:"text-right",children:"Jumlah"}),(0,s.jsx)(d,{children:"Status"}),(0,s.jsx)(d,{children:"Metode"}),(0,s.jsx)(d,{children:"Order ID"})]})}),(0,s.jsx)("tbody",{children:i&&0===e.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"p-4 text-slate-500",colSpan:7,children:"Memuat…"})}):0===e.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"p-6 text-slate-500",colSpan:7,children:"Belum ada pembayaran."})}):e.map(e=>{var t,a,n,r,l,i;return(0,s.jsxs)("tr",{className:"border-t border-slate-100",children:[(0,s.jsx)(u,{children:new Date(e.createdAt).toLocaleString("id-ID")}),(0,s.jsxs)(u,{children:[(0,s.jsx)("div",{className:"font-medium text-slate-900",children:(null===(t=e.employer)||void 0===t?void 0:t.displayName)||(null===(a=e.employer)||void 0===a?void 0:a.legalName)||"—"}),(0,s.jsx)("div",{className:"text-xs text-slate-500",children:(null===(n=e.employer)||void 0===n?void 0:n.slug)||"—"})]}),(0,s.jsxs)(u,{children:[(0,s.jsx)("div",{className:"text-slate-900",children:(null===(r=e.plan)||void 0===r?void 0:r.name)||"—"}),(0,s.jsxs)("div",{className:"text-xs text-slate-500",children:[(null===(l=e.plan)||void 0===l?void 0:l.slug)||"—"," ",(null===(i=e.plan)||void 0===i?void 0:i.interval)?"• /".concat(e.plan.interval):""]})]}),(0,s.jsx)(u,{className:"text-right font-semibold",children:o(e.grossAmount)}),(0,s.jsx)(u,{children:(0,s.jsx)("span",{className:"inline-flex rounded-full px-2 py-0.5 text-xs ".concat(h[e.status]||"bg-slate-100 text-slate-700"),children:e.status})}),(0,s.jsx)(u,{children:e.method||"—"}),(0,s.jsxs)(u,{children:[(0,s.jsx)("div",{className:"font-mono text-xs",children:e.orderId}),e.transactionId&&(0,s.jsx)("div",{className:"font-mono text-[11px] text-slate-500",children:e.transactionId})]})]},e.id)})})]})}),(0,s.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,s.jsxs)("span",{className:"text-xs text-slate-500",children:[e.length," item",1!==e.length?"s":"",p?" • status: ".concat(p):""]}),a?(0,s.jsx)("button",{onClick:()=>f({cursor:a}),className:"rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm hover:bg-slate-50",disabled:i,children:i?"Memuat…":"Muat lebih banyak"}):(0,s.jsx)("span",{className:"text-xs text-slate-400",children:"— selesai —"})]})]})}function f(){var e,t;let[a,n]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),[h,p]=(0,r.useState)(""),[b,f]=(0,r.useState)(""),[v,g]=(0,r.useState)(""),[j,y]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[k,E]=(0,r.useState)(""),[T,C]=(0,r.useState)(!1),[S,_]=(0,r.useState)(null),[I,P]=(0,r.useState)(""),L=(0,r.useMemo)(()=>a.find(e=>e.id===h),[a,h]);async function R(){if(!h||!v){u("Plan dan email wajib diisi.");return}u(null),C(!0);try{var e;let t=await (0,l.hi)("/api/payments/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:h,employerId:b||void 0,customer:{email:v,first_name:j,last_name:N,phone:k}})});_(t),(null===(e=window.snap)||void 0===e?void 0:e.pay)?window.snap.pay(t.token,{onSuccess:()=>P("settlement"),onPending:()=>P("pending"),onError:()=>P("error"),onClose:()=>P(e=>e||"closed")}):window.open(t.redirect_url,"_blank","noopener,noreferrer")}catch(e){u((null==e?void 0:e.message)||"Gagal memulai pembayaran")}finally{C(!1)}}return(0,r.useEffect)(()=>{(async()=>{try{c(!0),u(null);let e=(await (0,l.hi)("/admin/plans")).filter(e=>e.active);n(e),e.length>0&&!h&&p(e[0].id)}catch(e){u((null==e?void 0:e.message)||"Gagal memuat paket")}finally{c(!1)}})()},[]),(0,r.useEffect)(()=>{if(!(null==S?void 0:S.orderId))return;let e=!1,t=async()=>{try{let e=await (0,l.hi)("/api/payments/".concat(S.orderId));if(P((null==e?void 0:e.status)||""),["settlement","expire","cancel","deny","refund"].includes(null==e?void 0:e.status))return}catch(e){}e||setTimeout(t,2500)};return t(),()=>{e=!0}},[null==S?void 0:S.orderId]),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,s.jsx)("h2",{className:"mb-3 text-sm font-semibold text-slate-900",children:"Data Transaksi (Test)"}),d&&(0,s.jsx)("div",{className:"mb-3 rounded-xl border border-rose-200 bg-rose-50 px-4 py-2 text-rose-700",children:d}),i?(0,s.jsx)("div",{className:"text-slate-500",children:"Loading…"}):(0,s.jsxs)("div",{className:"grid gap-3",children:[(0,s.jsxs)("label",{className:"block text-sm",children:[(0,s.jsx)("div",{className:"mb-1 text-slate-600",children:"Paket"}),(0,s.jsx)("select",{value:h,onChange:e=>p(e.target.value),className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm",children:a.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," — ",o(e.amount)," / ",e.interval]},e.id))})]}),(0,s.jsxs)("label",{className:"block text-sm",children:[(0,s.jsx)("div",{className:"mb-1 text-slate-600",children:"Employer ID (opsional)"}),(0,s.jsx)("input",{value:b,onChange:e=>f(e.target.value),placeholder:"uuid employer (jika ada)",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm"})]}),(0,s.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"block text-sm",children:[(0,s.jsx)("div",{className:"mb-1 text-slate-600",children:"Email Customer"}),(0,s.jsx)("input",{type:"email",value:v,onChange:e=>g(e.target.value),className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm",placeholder:"customer@email.com"})]}),(0,s.jsxs)("label",{className:"block text-sm",children:[(0,s.jsx)("div",{className:"mb-1 text-slate-600",children:"Telepon (opsional)"}),(0,s.jsx)("input",{value:k,onChange:e=>E(e.target.value),className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm",placeholder:"08xxxxxxxxxx"})]})]}),(0,s.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"block text-sm",children:[(0,s.jsx)("div",{className:"mb-1 text-slate-600",children:"Nama Depan"}),(0,s.jsx)("input",{value:j,onChange:e=>y(e.target.value),className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm"})]}),(0,s.jsxs)("label",{className:"block text-sm",children:[(0,s.jsx)("div",{className:"mb-1 text-slate-600",children:"Nama Belakang"}),(0,s.jsx)("input",{value:N,onChange:e=>w(e.target.value),className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm"})]})]}),(0,s.jsx)("button",{onClick:R,disabled:T||!h||!v,className:"mt-2 inline-flex w-full items-center justify-center rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-blue-700 disabled:opacity-60",children:T?"Membuat transaksi…":"Buat Pembayaran"}),!x&&(0,s.jsxs)("p",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded-lg px-3 py-2",children:[(0,s.jsx)("b",{children:"Warning:"})," ",(0,s.jsx)("code",{children:"NEXT_PUBLIC_MIDTRANS_CLIENT_KEY"})," belum diset. Snap tidak bisa dibuka, sistem akan membuka ",(0,s.jsx)("em",{children:"redirect_url"})," saja."]})]})]}),(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,s.jsx)("h2",{className:"mb-3 text-sm font-semibold text-slate-900",children:"Ringkasan"}),(0,s.jsxs)("dl",{className:"space-y-2 text-sm",children:[(0,s.jsx)(m,{label:"Paket",children:null!==(e=null==L?void 0:L.name)&&void 0!==e?e:"-"}),(0,s.jsx)(m,{label:"Harga",children:L?o(L.amount):"-"}),(0,s.jsx)(m,{label:"Interval",children:null!==(t=null==L?void 0:L.interval)&&void 0!==t?t:"-"}),(0,s.jsx)(m,{label:"Email",children:v||"-"}),(0,s.jsx)(m,{label:"Employer ID",children:b||"-"})]}),S&&(0,s.jsxs)("div",{className:"mt-5 rounded-xl border border-blue-200 bg-blue-50 p-3 text-sm",children:[(0,s.jsx)("div",{className:"font-semibold text-blue-900",children:"Transaksi dibuat"}),(0,s.jsxs)("div",{className:"mt-1 text-blue-800",children:["Order ID: ",(0,s.jsx)("code",{className:"font-mono",children:S.orderId})]}),(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)("button",{onClick:()=>{var e;return(null===(e=window.snap)||void 0===e?void 0:e.pay)?window.snap.pay(S.token):window.open(S.redirect_url,"_blank","noopener,noreferrer")},className:"mt-2 rounded-lg bg-blue-600 px-3 py-1.5 text-white hover:bg-blue-700",children:"Buka Snap"})})]}),I&&(0,s.jsxs)("div",{className:"mt-4 rounded-xl border px-3 py-2 text-sm",style:{borderColor:"#cbd5e1",background:"#f8fafc"},children:["Status transaksi: ",(0,s.jsx)("b",{children:I})]})]})]})}},71837:function(e,t,a){"use strict";a.d(t,{Sg:function(){return s},hF:function(){return u},hi:function(){return d},vL:function(){return m}});var n=a(40257);let s=(n.env.NEXT_PUBLIC_API_URL||n.env.NEXT_PUBLIC_API_BASE||"http://localhost:4000").replace(/\/+$/,""),r="true"===(n.env.NEXT_PUBLIC_FORCE_DIRECT_API||"false"),l="true"===(n.env.NEXT_PUBLIC_SKIP_EMPLOYER_CHECK||"false");function i(e){return e?/^https?:\/\//i.test(e)?e:r?"".concat(s).concat(e.startsWith("/")?"":"/").concat(e):e.startsWith("/")?e:"".concat(s).concat(e.startsWith("/")?"":"/").concat(e):s}async function o(e){try{if((e.headers.get("content-type")||"").includes("application/json")){let t=await e.json().catch(()=>({}));return(null==t?void 0:t.message)||(null==t?void 0:t.error)||"HTTP ".concat(e.status)}return await e.text()||"HTTP ".concat(e.status)}catch(t){return"HTTP ".concat(e.status)}}async function c(e){try{if((e.headers.get("content-type")||"").includes("application/json"))return await e.json().catch(()=>({message:"Failed to parse error JSON"}));return{message:await e.text()||"HTTP ".concat(e.status)}}catch(t){return{message:"HTTP ".concat(e.status)}}}async function d(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{json:n,headers:s,expectJson:r=!0,...o}=a;try{if(String(e||"").toLowerCase().includes("/api/employers")&&(console.log("[TRACE][api] Employer endpoint called: ".concat(e)),console.trace(),l))throw Error("[SKIP_EMPLOYER_CHECK] skipped call to ".concat(e))}catch(e){console.warn("[TRACE][api] trace helper error (ignored):",e)}let d=new Headers(s||{}),u=o.body instanceof FormData;void 0===n||u||d.set("Content-Type","application/json");let m={credentials:"include",headers:d,...void 0!==n?{method:null!==(t=o.method)&&void 0!==t?t:"POST",body:JSON.stringify(n)}:{},...o},x=i(e),h=await fetch(x,m);if(!h.ok){let e=await c(h),t=Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"HTTP ".concat(h.status));throw t.response={data:e,status:h.status,config:{url:x}},t}return 204!==h.status&&r?(h.headers.get("content-type")||"").includes("application/json")?await h.json():await h.text():null}async function u(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(String(e||"").toLowerCase().includes("/api/employers")&&(console.log("[TRACE][apiForm] Employer endpoint called: ".concat(e)),console.trace(),l))throw Error("[SKIP_EMPLOYER_CHECK] skipped call to ".concat(e))}catch(e){console.warn("[TRACE][apiForm] trace helper error (ignored):",e)}let n=i(e),s=await fetch(n,{method:"POST",body:t,credentials:"include",...a});if(!s.ok){let e=await c(s),t=Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"HTTP ".concat(s.status));throw t.response={data:e,status:s.status,config:{url:n}},t}return(s.headers.get("content-type")||"").includes("application/json")?await s.json():null}async function m(){let e=function(e,t){if(!t)return e;let a=window.location.origin,n=new URL(e.startsWith("/")?"".concat(a).concat(e):e);for(let[e,a]of Object.entries(t))null!=a&&""!==a&&n.searchParams.set(e,String(a));return e.startsWith("/")?"".concat(n.pathname).concat(n.search):n.toString()}("".concat(s,"/api/rates"),{base:"USD",symbols:"IDR"}),t=await fetch(e,{cache:"no-store",credentials:"include"});if(!t.ok)throw Error("[".concat(t.status,"] ").concat(await o(t)));let a=await t.json().catch(()=>({})),n=Number(null==a?void 0:a.rate);if(!Number.isFinite(n))throw Error("Invalid rate");return n}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=35285)}),_N_E=e.O()}]);