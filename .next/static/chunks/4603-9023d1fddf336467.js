"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4603],{84603:function(e,t,n){n.d(t,{AuthProvider:function(){return m},a:function(){return p}});var o=n(57437),l=n(2265),a=n(71837);let r=(0,l.createContext)(null),i="ark:auth:user:v1";function s(){try{var e;let t=localStorage.getItem(i);if(!t)return null;let n=JSON.parse(t);if(!(null==n?void 0:n.ts))return null;if(Date.now()-n.ts>18e5)return localStorage.removeItem(i),null;return null!==(e=n.user)&&void 0!==e?e:null}catch(e){return console.warn("[Auth][readSnapshot] parse error",e),null}}let u=e=>(e&&e.includes("@")?e.split("@")[0]:e)||"",c=e=>{var t;return(null==e?void 0:null===(t=e.displayName)||void 0===t?void 0:t.trim())||u(null==e?void 0:e.email)||"Company"},d=e=>(null==e?void 0:e.name)&&String(e.name).trim()||u(null==e?void 0:e.email)||"User",h=e=>{var t,n;return(null==e?void 0:null===(n=e.username)||void 0===n?void 0:null===(t=n.trim)||void 0===t?void 0:t.call(n))||"Admin"};function g(e){var t,n;return e?null!==(n=null!==(t=e.data)&&void 0!==t?t:e.user)&&void 0!==n?n:e:null}function m(e){let{children:t}=e,[n,u]=(0,l.useState)(()=>s()),[m,p]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=e=>{e.key===i&&(console.log("[Auth] storage event - updating user from snapshot"),u(s()))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);let v=(0,l.useCallback)(e=>{console.log("[Auth] Setting user & cache:",e),u(e),function(e){try{e?localStorage.setItem(i,JSON.stringify({ts:Date.now(),user:e})):localStorage.removeItem(i)}catch(e){console.warn("[Auth][writeSnapshot] error",e)}}(e)},[]),f=(0,l.useCallback)(async()=>{console.log("Auth Refresh: Checking session..."),p(!0);try{try{console.log("Auth Refresh: trying /api/admin/me...");let e=await (0,a.hi)("/api/admin/me");console.log("Auth Refresh: /api/admin/me response:",e);let t=function(e){var t,n,o;let l=g(e);return l&&"admin"===(null!==(t=l.role)&&void 0!==t?t:"admin").toString().toLowerCase()&&l.id?{id:l.id,email:l.username?"".concat(l.username,"@local"):null!==(n=l.email)&&void 0!==n?n:null,name:h(l),role:"admin",username:null!==(o=l.username)&&void 0!==o?o:null}:null}(e);if(t){v(t),console.log("Auth Refresh: admin found");return}}catch(e){console.log("Auth Refresh: admin check failed (ok to continue):",(null==e?void 0:e.message)||e)}try{console.log("Auth Refresh: trying /api/employers/auth/me...");let e=await (0,a.hi)("/api/employers/auth/me");console.log("Auth Refresh: /api/employers/auth/me response:",e);let t=function(e){var t,n,o,l,a,r;let i=g(e);if(!i||"employer"!==(null!==(n=i.role)&&void 0!==n?n:"employer").toString().toLowerCase())return null;let s=null!==(o=i.employer)&&void 0!==o?o:i.employerId?{id:i.employerId,displayName:i.displayName}:null;return{id:i.id||i.adminId||(null===(t=i.admin)||void 0===t?void 0:t.id)||String(null!==(a=null!==(l=i.email)&&void 0!==l?l:i.id)&&void 0!==a?a:"unknown"),email:null!==(r=i.email)&&void 0!==r?r:null,name:c(i),role:"employer",employer:s?{id:s.id,slug:s.slug,displayName:s.displayName}:void 0}}(e);if(t){v(t),console.log("Auth Refresh: employer found");return}}catch(e){console.log("Auth Refresh: employer check failed (ok to continue):",(null==e?void 0:e.message)||e)}try{console.log("Auth Refresh: trying /auth/me...");let e=await (0,a.hi)("/auth/me");console.log("Auth Refresh: /auth/me response:",e);let t=function(e){var t,n,o,l;let a=g(e);return a&&"user"===(null!==(t=a.role)&&void 0!==t?t:"user").toString().toLowerCase()&&a.id?{id:a.id,email:null!==(n=a.email)&&void 0!==n?n:null,name:d(a),photoUrl:null!==(o=a.photoUrl)&&void 0!==o?o:null,cvUrl:null!==(l=a.cvUrl)&&void 0!==l?l:null,role:"user"}:null}(e);if(t){v(t),console.log("Auth Refresh: user found");return}}catch(e){console.log("Auth Refresh: user check failed (ok to continue):",(null==e?void 0:e.message)||e)}console.log("Auth Refresh: no valid session found"),v(null)}catch(e){console.error("Auth Refresh: unexpected error",e),v(null)}finally{p(!1),console.log("Auth Refresh: finished")}},[v]);(0,l.useEffect)(()=>{f()},[f]);let y=(0,l.useCallback)(async(e,t)=>{console.log("[signinUser] trying",e);try{let n=await (0,a.hi)("/api/auth/signin",{json:{usernameOrEmail:e,password:t}});console.log("[signinUser] signin response:",n),await f();let o=s();if(!o)throw console.error("[signinUser] Snapshot still null after refresh"),Error("Signin succeeded but session not established in client");return o}catch(e){var n,o;throw Error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.message)||(null==e?void 0:e.message)||"Login failed. Please try again.")}},[f]),w=(0,l.useCallback)(async(e,t,n)=>{console.log("[signup] creating",t);try{let o=await (0,a.hi)("/auth/signup",{json:{name:e,email:t,password:n}});return console.log("[signup] response:",o),o}catch(e){var o,l;throw Error((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(o=l.data)||void 0===o?void 0:o.message)||(null==e?void 0:e.message)||"Signup failed. Please try again.")}},[f]),E=(0,l.useCallback)(async(e,t)=>{console.log("[signinEmployer] trying",e);try{let n=await (0,a.hi)("/api/employers/auth/signin",{json:{usernameOrEmail:e,password:t}});console.log("[signinEmployer] response:",n),await f();let o=s();if(!o)throw Error("Employer signin succeeded but session not established in client");return o}catch(e){var n,o;throw Error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.message)||(null==e?void 0:e.message)||"Login failed. Please try again.")}},[f]),S=(0,l.useCallback)(async(e,t)=>{console.log("[signinAdmin] trying",e);try{let n=await (0,a.hi)("/api/admin/signin",{json:{usernameOrEmail:e,password:t}});console.log("[signinAdmin] response:",n),await f();let o=s();if(!o)throw Error("Admin signin succeeded but session not established in client");return o}catch(e){var n,o;throw Error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.message)||(null==e?void 0:e.message)||"Login failed. Please try again.")}},[f]),C=(0,l.useCallback)(async()=>{console.log("[signout] calling signout endpoints to clear cookies"),p(!0);try{(null==n?void 0:n.role)==="employer"?await (0,a.hi)("/api/employers/auth/signout",{method:"POST",expectJson:!1}):(null==n?void 0:n.role)==="admin"?await (0,a.hi)("/api/admin/signout",{method:"POST",expectJson:!1}):await (0,a.hi)("/auth/signout",{method:"POST",expectJson:!1})}catch(e){console.warn("[signout] signout endpoint error (ignored):",e);try{await (0,a.hi)("/api/employers/auth/signout",{method:"POST",expectJson:!1})}catch(e){}try{await (0,a.hi)("/auth/signout",{method:"POST",expectJson:!1})}catch(e){}try{await (0,a.hi)("/api/admin/signout",{method:"POST",expectJson:!1})}catch(e){}}finally{!function(){try{localStorage.removeItem(i)}catch(e){console.warn("[Auth][clearSnapshot] error",e)}}(),u(null),p(!1)}},[n]),P=(0,l.useMemo)(()=>({user:n,loading:m,signinUser:y,signup:w,signinEmployer:E,signinAdmin:S,signout:C,refresh:f}),[n,m,y,w,E,S,C,f]);return(0,o.jsx)(r.Provider,{value:P,children:t})}let p=()=>(0,l.useContext)(r)},71837:function(e,t,n){n.d(t,{Sg:function(){return l},hF:function(){return d},hi:function(){return c},vL:function(){return h}});var o=n(40257);let l=(o.env.NEXT_PUBLIC_API_URL||o.env.NEXT_PUBLIC_API_BASE||"http://localhost:4000").replace(/\/+$/,""),a="true"===(o.env.NEXT_PUBLIC_FORCE_DIRECT_API||"false"),r="true"===(o.env.NEXT_PUBLIC_SKIP_EMPLOYER_CHECK||"false");function i(e){return e?/^https?:\/\//i.test(e)?e:a?"".concat(l).concat(e.startsWith("/")?"":"/").concat(e):e.startsWith("/")?e:"".concat(l).concat(e.startsWith("/")?"":"/").concat(e):l}async function s(e){try{if((e.headers.get("content-type")||"").includes("application/json")){let t=await e.json().catch(()=>({}));return(null==t?void 0:t.message)||(null==t?void 0:t.error)||"HTTP ".concat(e.status)}return await e.text()||"HTTP ".concat(e.status)}catch(t){return"HTTP ".concat(e.status)}}async function u(e){try{if((e.headers.get("content-type")||"").includes("application/json"))return await e.json().catch(()=>({message:"Failed to parse error JSON"}));return{message:await e.text()||"HTTP ".concat(e.status)}}catch(t){return{message:"HTTP ".concat(e.status)}}}async function c(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{json:o,headers:l,expectJson:a=!0,...s}=n;try{if(String(e||"").toLowerCase().includes("/api/employers")&&(console.log("[TRACE][api] Employer endpoint called: ".concat(e)),console.trace(),r))throw Error("[SKIP_EMPLOYER_CHECK] skipped call to ".concat(e))}catch(e){console.warn("[TRACE][api] trace helper error (ignored):",e)}let c=new Headers(l||{}),d=s.body instanceof FormData;void 0===o||d||c.set("Content-Type","application/json");let h={credentials:"include",headers:c,...void 0!==o?{method:null!==(t=s.method)&&void 0!==t?t:"POST",body:JSON.stringify(o)}:{},...s},g=i(e),m=await fetch(g,h);if(!m.ok){let e=await u(m),t=Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"HTTP ".concat(m.status));throw t.response={data:e,status:m.status,config:{url:g}},t}return 204!==m.status&&a?(m.headers.get("content-type")||"").includes("application/json")?await m.json():await m.text():null}async function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(String(e||"").toLowerCase().includes("/api/employers")&&(console.log("[TRACE][apiForm] Employer endpoint called: ".concat(e)),console.trace(),r))throw Error("[SKIP_EMPLOYER_CHECK] skipped call to ".concat(e))}catch(e){console.warn("[TRACE][apiForm] trace helper error (ignored):",e)}let o=i(e),l=await fetch(o,{method:"POST",body:t,credentials:"include",...n});if(!l.ok){let e=await u(l),t=Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"HTTP ".concat(l.status));throw t.response={data:e,status:l.status,config:{url:o}},t}return(l.headers.get("content-type")||"").includes("application/json")?await l.json():null}async function h(){let e=function(e,t){if(!t)return e;let n=window.location.origin,o=new URL(e.startsWith("/")?"".concat(n).concat(e):e);for(let[e,n]of Object.entries(t))null!=n&&""!==n&&o.searchParams.set(e,String(n));return e.startsWith("/")?"".concat(o.pathname).concat(o.search):o.toString()}("".concat(l,"/api/rates"),{base:"USD",symbols:"IDR"}),t=await fetch(e,{cache:"no-store",credentials:"include"});if(!t.ok)throw Error("[".concat(t.status,"] ").concat(await s(t)));let n=await t.json().catch(()=>({})),o=Number(null==n?void 0:n.rate);if(!Number.isFinite(o))throw Error("Invalid rate");return o}}}]);